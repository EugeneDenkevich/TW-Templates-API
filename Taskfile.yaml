version: '3'

output: 'prefixed'

tasks:

  format:
    cmds:
      - >
        poetry run autoflake
        --exclude '*.local*'
        --expand-star-imports
        --in-place
        --recursive
        --remove-all-unused-imports
        --remove-duplicate-keys
        --remove-unused-variables
        --verbose
        .
      - poetry run black .
      - poetry run isort .
    desc: "format code with autoflake, black, isort"

  run:
    cmds:
      - poetry run alembic upgrade head
      - poetry run python main.py

  reload:
    cmds:
      - task: format
      - task: run

  test:
    cmds:
      - poetry run pytest -s
  
  dbinit:
    cmds:
      - rm ./dev.db | exit 0
      - rm -r ./api/migrations/versions/* | exit 0
      - poetry run alembic revision --autogenerate -m "init_db"
